# =============================================================================
# Homelab - Configuration Terraform
# =============================================================================
# 1. Copier ce fichier en terraform.tfvars
# 2. Remplir les valeurs avec vos informations
# 3. NE PAS commiter terraform.tfvars (contient des secrets)
# =============================================================================

# -----------------------------------------------------------------------------
# Connexion Proxmox
# -----------------------------------------------------------------------------

# URL de votre serveur Proxmox (remplacer l'IP)
proxmox_endpoint = "https://192.168.1.100:8006"

# Token API créé lors de l'installation
# Format: user@realm!token-name=secret
proxmox_api_token = "terraform@pve!terraform-token=xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"

# true si certificat auto-signé (défaut Proxmox)
proxmox_insecure = true

# -----------------------------------------------------------------------------
# Infrastructure Proxmox
# -----------------------------------------------------------------------------

# Nom du node Proxmox (visible dans l'interface web)
default_node = "pve"

# ID du template VM cloud-init (créé lors de l'installation)
vm_template_id = 9000

# Template LXC (téléchargé lors de l'installation - Ubuntu 24.04 recommandé pour PVE 9.x)
lxc_template = "local:vztmpl/debian-13-standard_13.1-2_amd64.tar.zst"

# Datastore pour les disques
default_datastore = "local-lvm"

# -----------------------------------------------------------------------------
# Réseau
# -----------------------------------------------------------------------------

# Bridge réseau Proxmox
network_bridge = "vmbr0"

# Passerelle (votre routeur/box)
network_gateway = "192.168.1.1"

# Serveurs DNS
network_dns = ["1.1.1.1", "8.8.8.8"]

# -----------------------------------------------------------------------------
# SSH
# -----------------------------------------------------------------------------

# Clé(s) SSH publique(s) pour accéder aux VMs/LXC
# Copier le contenu de ~/.ssh/id_ed25519.pub ou ~/.ssh/id_rsa.pub
ssh_public_keys = [
  "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIxxx... user@workstation"
]

# -----------------------------------------------------------------------------
# Environnement
# -----------------------------------------------------------------------------

environment = "home"

# -----------------------------------------------------------------------------
# VMs
# -----------------------------------------------------------------------------

vms = {
  # Exemple de VM simple
  "my-vm" = {
    ip     = "192.168.1.10"
    cores  = 2
    memory = 2048
    disk   = 20
    tags   = ["web"]
  }
  # Exemple de VM avec Docker et node_exporter pour monitoring
  # "docker-server" = {
  #   ip            = "192.168.1.20"
  #   cores         = 4
  #   memory        = 4096
  #   disk          = 50
  #   docker        = true
  #   node_exporter = true  # Activer pour exposer les metriques systeme
  #   tags          = ["docker", "server", "monitored"]
  # }
}

# -----------------------------------------------------------------------------
# Conteneurs LXC
# -----------------------------------------------------------------------------

containers = {
  # Exemple de conteneur LXC
  # "my-service" = {
  #   ip      = "192.168.1.30"
  #   cores   = 1
  #   memory  = 512
  #   disk    = 10
  #   nesting = false
  #   tags    = ["service"]
  # }
}

# -----------------------------------------------------------------------------
# Stack Monitoring (Prometheus + Grafana + Alertmanager)
# -----------------------------------------------------------------------------
# Deploie une VM avec la stack complete de monitoring.
# Prerequis:
# - Token API Proxmox read-only pour prometheus (pve-exporter)
# - Bot Telegram cree via @BotFather (optionnel)
# - node_exporter installe sur les hosts Proxmox (script fourni)
# -----------------------------------------------------------------------------

monitoring = {
  enabled = false # Passer a true pour activer

  # Node Proxmox pour la VM monitoring (null = default_node)
  node = null

  # Configuration de la VM monitoring
  vm = {
    ip        = "192.168.1.51"
    cores     = 2
    memory    = 4096
    disk      = 30
    data_disk = 50 # Stockage metriques Prometheus
  }

  # Nodes Proxmox a monitorer (extensible)
  proxmox_nodes = [
    { name = "pve1", ip = "192.168.1.100" },
    # { name = "pve2", ip = "192.168.1.50" },
  ]

  # Credentials pve-exporter (token read-only)
  # Creer avec:
  #   pveum user add prometheus@pve
  #   pveum aclmod / -user prometheus@pve -role PVEAuditor
  #   pveum user token add prometheus@pve prometheus -privsep=0
  pve_exporter = {
    user        = "prometheus@pve"
    token_name  = "prometheus"
    token_value = "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"
  }

  # Retention des metriques (jours)
  retention_days = 30

  # Mot de passe admin Grafana
  grafana_admin_password = "ChangeMePlease123!"

  # Notifications Telegram (optionnel)
  # Creer un bot via @BotFather et recuperer le chat_id
  telegram = {
    enabled   = false
    bot_token = "" # Token du bot (@BotFather)
    chat_id   = "" # ID du chat/groupe (utiliser @userinfobot)
  }
}
