# =============================================================================
# Monitoring - Configuration Terraform
# =============================================================================
# PVE dedie au monitoring centralise de tous les environnements.
# 1. Copier ce fichier en terraform.tfvars
# 2. Remplir les valeurs avec vos informations
# 3. NE PAS commiter terraform.tfvars (contient des secrets)
# =============================================================================

# -----------------------------------------------------------------------------
# Connexion Proxmox (PVE dedie monitoring)
# -----------------------------------------------------------------------------

# URL du serveur Proxmox dedie au monitoring
proxmox_endpoint = "https://192.168.1.50:8006"

# Token API cree sur cette instance Proxmox
# Format: user@realm!token-name=secret
proxmox_api_token = "terraform@pve!terraform-token=xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"

# true si certificat auto-signe (defaut Proxmox)
proxmox_insecure = true

# -----------------------------------------------------------------------------
# Infrastructure Proxmox
# -----------------------------------------------------------------------------

# Nom du node Proxmox dedie monitoring
default_node = "pve-mon"

# ID du template VM cloud-init
vm_template_id = 9000

# Datastore pour les disques
default_datastore = "local-lvm"

# -----------------------------------------------------------------------------
# Reseau
# -----------------------------------------------------------------------------

# Bridge reseau Proxmox
network_bridge = "vmbr0"

# Passerelle
network_gateway = "192.168.1.1"

# Serveurs DNS
network_dns = ["1.1.1.1", "8.8.8.8"]

# -----------------------------------------------------------------------------
# SSH
# -----------------------------------------------------------------------------

# Cle(s) SSH publique(s) pour acceder aux VMs
ssh_public_keys = [
  "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIxxx... user@workstation"
]

# -----------------------------------------------------------------------------
# Environnement
# -----------------------------------------------------------------------------

environment = "monitoring"

# -----------------------------------------------------------------------------
# Stack Monitoring (Prometheus + Grafana + Alertmanager)
# -----------------------------------------------------------------------------
# Supervise TOUS les PVE (prod, lab, monitoring)
# Les nodes Proxmox doivent etre accessibles depuis ce reseau
# -----------------------------------------------------------------------------

monitoring = {
  # Node Proxmox pour la VM monitoring (null = default_node)
  node = null

  # Configuration de la VM monitoring
  vm = {
    ip        = "192.168.1.51"
    cores     = 2
    memory    = 4096
    disk      = 30
    data_disk = 50 # Stockage metriques Prometheus
  }

  # TOUS les nodes Proxmox a monitorer (multi-PVE)
  proxmox_nodes = [
    { name = "pve-prod", ip = "192.168.1.100" },  # PVE prod
    { name = "pve-lab", ip = "192.168.1.110" },    # PVE lab
    { name = "pve-mon", ip = "192.168.1.50" },    # PVE monitoring (lui-meme)
  ]

  # Credentials pve-exporter (token read-only)
  # Le meme token doit etre cree sur CHAQUE PVE a monitorer :
  #   pveum user add prometheus@pve
  #   pveum aclmod / -user prometheus@pve -role PVEAuditor
  #   pveum user token add prometheus@pve prometheus -privsep=0
  pve_exporter = {
    user        = "prometheus@pve"
    token_name  = "prometheus"
    token_value = "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"
  }

  # Retention des metriques (jours)
  retention_days = 30

  # Mot de passe admin Grafana
  grafana_admin_password = "ChangeMePlease123!"

  # Notifications Telegram (optionnel)
  telegram = {
    enabled   = false
    bot_token = "" # Token du bot (@BotFather)
    chat_id   = "" # ID du chat/groupe
  }
}

# -----------------------------------------------------------------------------
# Cibles distantes (VMs sur d'autres PVE)
# -----------------------------------------------------------------------------
# VMs avec node_exporter sur d'autres PVE.
# Toutes les VMs sont sur le meme reseau 192.168.1.0/24.
# -----------------------------------------------------------------------------

remote_targets = [
  # VMs sur PVE prod (192.168.1.0/24)
  # {
  #   name = "web-server"
  #   ip   = "192.168.1.101"
  #   port = 9100
  #   labels = {
  #     app         = "web-server"
  #     type        = "vm"
  #     environment = "prod"
  #   }
  # },
  # VMs sur PVE lab (192.168.1.0/24)
  # {
  #   name = "file-server"
  #   ip   = "192.168.1.111"
  #   port = 9100
  #   labels = {
  #     app         = "file-server"
  #     type        = "vm"
  #     environment = "lab"
  #   }
  # },
]
