{"id":null,"uid":"prometheus-self","title":"Prometheus - Self Monitoring","description":"Prometheus self-monitoring: TSDB, targets, scrapes, rules, Go runtime","tags":["prometheus","self-monitoring"],"timezone":"browser","editable":false,"graphTooltip":1,"refresh":"30s","time":{"from":"now-1h","to":"now"},"templating":{"list":[]},"panels":[{"title":"Targets Up","type":"stat","gridPos":{"h":4,"w":4,"x":0,"y":0},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"thresholds":{"steps":[{"color":"red","value":null},{"color":"green","value":1}]}},"overrides":[]},"options":{"colorMode":"background","graphMode":"none","textMode":"auto"},"targets":[{"expr":"count(up == 1)","legendFormat":"Up","refId":"A"}]},{"title":"Targets Down","type":"stat","gridPos":{"h":4,"w":4,"x":4,"y":0},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"thresholds":{"steps":[{"color":"green","value":null},{"color":"red","value":1}]}},"overrides":[]},"options":{"colorMode":"background","graphMode":"none","textMode":"auto"},"targets":[{"expr":"count(up == 0) or vector(0)","legendFormat":"Down","refId":"A"}]},{"title":"Active Alert Rules","type":"stat","gridPos":{"h":4,"w":4,"x":8,"y":0},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"thresholds":{"steps":[{"color":"blue","value":null}]}},"overrides":[]},"options":{"colorMode":"value","graphMode":"none","textMode":"auto"},"targets":[{"expr":"sum(prometheus_rule_group_rules) or vector(0)","legendFormat":"Rules","refId":"A"}]},{"title":"TSDB Head Series","type":"stat","gridPos":{"h":4,"w":4,"x":12,"y":0},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"thresholds":{"steps":[{"color":"blue","value":null}]}},"overrides":[]},"options":{"colorMode":"value","graphMode":"area","textMode":"auto"},"targets":[{"expr":"prometheus_tsdb_head_series","legendFormat":"Series","refId":"A"}]},{"title":"Uptime","type":"stat","gridPos":{"h":4,"w":4,"x":16,"y":0},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"unit":"s","thresholds":{"steps":[{"color":"green","value":null}]}},"overrides":[]},"options":{"colorMode":"value","graphMode":"none","textMode":"auto"},"targets":[{"expr":"(time() - process_start_time_seconds{job=\"prometheus\"})","legendFormat":"Uptime","refId":"A"}]},{"title":"Head Chunks","type":"stat","gridPos":{"h":4,"w":4,"x":20,"y":0},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"thresholds":{"steps":[{"color":"purple","value":null}]}},"overrides":[]},"options":{"colorMode":"value","graphMode":"area","textMode":"auto"},"targets":[{"expr":"prometheus_tsdb_head_chunks","legendFormat":"Chunks","refId":"A"}]},{"title":"Scrapes & Ingestion","type":"row","gridPos":{"h":1,"w":24,"x":0,"y":4},"collapsed":false,"panels":[]},{"title":"Scrape Duration by Job","type":"timeseries","gridPos":{"h":8,"w":12,"x":0,"y":5},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"unit":"s","custom":{"fillOpacity":20,"lineWidth":2,"spanNulls":false}},"overrides":[]},"options":{"legend":{"displayMode":"table","calcs":["mean","max"]},"tooltip":{"mode":"multi"}},"targets":[{"expr":"scrape_duration_seconds","legendFormat":"{{ job }} - {{ instance }}","refId":"A"}]},{"title":"Samples Ingested per Second","type":"timeseries","gridPos":{"h":8,"w":12,"x":12,"y":5},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"unit":"ops","custom":{"fillOpacity":20,"lineWidth":2,"spanNulls":false}},"overrides":[]},"options":{"legend":{"displayMode":"table","calcs":["mean","max"]},"tooltip":{"mode":"multi"}},"targets":[{"expr":"sum(rate(prometheus_tsdb_head_samples_appended_total[5m]))","legendFormat":"Samples/s","refId":"A"}]},{"title":"Target Scrape Errors","type":"timeseries","gridPos":{"h":8,"w":12,"x":0,"y":13},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"unit":"short","custom":{"fillOpacity":20,"lineWidth":2,"spanNulls":false}},"overrides":[]},"options":{"legend":{"displayMode":"table","calcs":["mean","max"]},"tooltip":{"mode":"multi"}},"targets":[{"expr":"rate(prometheus_target_scrapes_exceeded_sample_limit_total[5m])","legendFormat":"Sample limit exceeded","refId":"A"},{"expr":"rate(prometheus_target_scrapes_sample_duplicate_timestamp_total[5m])","legendFormat":"Duplicate timestamps","refId":"B"},{"expr":"rate(prometheus_target_scrapes_sample_out_of_bounds_total[5m])","legendFormat":"Out of bounds","refId":"C"},{"expr":"rate(prometheus_target_scrapes_sample_out_of_order_total[5m])","legendFormat":"Out of order","refId":"D"}]},{"title":"Target Sync Duration","type":"timeseries","gridPos":{"h":8,"w":12,"x":12,"y":13},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"unit":"ms","custom":{"fillOpacity":20,"lineWidth":2,"spanNulls":false}},"overrides":[]},"options":{"legend":{"displayMode":"table","calcs":["mean","max"]},"tooltip":{"mode":"multi"}},"targets":[{"expr":"sum(rate(prometheus_target_sync_length_seconds_sum[2m])) by (scrape_job) * 1000","legendFormat":"{{ scrape_job }}","refId":"A"}]},{"title":"TSDB & Storage","type":"row","gridPos":{"h":1,"w":24,"x":0,"y":21},"collapsed":false,"panels":[]},{"title":"TSDB Storage Size","type":"timeseries","gridPos":{"h":8,"w":12,"x":0,"y":22},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"unit":"bytes","custom":{"fillOpacity":20,"lineWidth":2,"spanNulls":false}},"overrides":[]},"options":{"legend":{"displayMode":"table","calcs":["mean","max"]},"tooltip":{"mode":"multi"}},"targets":[{"expr":"prometheus_tsdb_storage_blocks_bytes","legendFormat":"Blocks","refId":"A"},{"expr":"prometheus_tsdb_wal_storage_size_bytes","legendFormat":"WAL","refId":"B"}]},{"title":"Series Created / Removed","type":"timeseries","gridPos":{"h":8,"w":12,"x":12,"y":22},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"unit":"short","custom":{"fillOpacity":20,"lineWidth":2,"spanNulls":false}},"overrides":[]},"options":{"legend":{"displayMode":"table","calcs":["mean","max"]},"tooltip":{"mode":"multi"}},"targets":[{"expr":"sum(increase(prometheus_tsdb_head_series_created_total[5m]))","legendFormat":"Created","refId":"A"},{"expr":"sum(increase(prometheus_tsdb_head_series_removed_total[5m]))","legendFormat":"Removed","refId":"B"}]},{"title":"Head Series Count","type":"timeseries","gridPos":{"h":8,"w":12,"x":0,"y":30},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"unit":"short","custom":{"fillOpacity":20,"lineWidth":2,"spanNulls":false}},"overrides":[]},"options":{"legend":{"displayMode":"table","calcs":["mean","max"]},"tooltip":{"mode":"multi"}},"targets":[{"expr":"prometheus_tsdb_head_series","legendFormat":"Head Series","refId":"A"}]},{"title":"Head Chunks Count","type":"timeseries","gridPos":{"h":8,"w":12,"x":12,"y":30},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"unit":"short","custom":{"fillOpacity":20,"lineWidth":2,"spanNulls":false}},"overrides":[]},"options":{"legend":{"displayMode":"table","calcs":["mean","max"]},"tooltip":{"mode":"multi"}},"targets":[{"expr":"prometheus_tsdb_head_chunks","legendFormat":"Head Chunks","refId":"A"}]},{"title":"Rules & Alerts","type":"row","gridPos":{"h":1,"w":24,"x":0,"y":38},"collapsed":false,"panels":[]},{"title":"Rule Evaluation Duration","type":"timeseries","gridPos":{"h":8,"w":12,"x":0,"y":39},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"unit":"s","custom":{"fillOpacity":20,"lineWidth":2,"spanNulls":false}},"overrides":[]},"options":{"legend":{"displayMode":"table","calcs":["mean","max"]},"tooltip":{"mode":"multi"}},"targets":[{"expr":"prometheus_rule_group_last_duration_seconds","legendFormat":"{{ rule_group }}","refId":"A"}]},{"title":"Config Reload Status","type":"timeseries","gridPos":{"h":8,"w":12,"x":12,"y":39},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"custom":{"fillOpacity":20,"lineWidth":2,"spanNulls":false},"mappings":[{"type":"value","options":{"1":{"text":"Success"},"0":{"text":"Failed"}}}]},"overrides":[]},"options":{"legend":{"displayMode":"list"},"tooltip":{"mode":"multi"}},"targets":[{"expr":"prometheus_config_last_reload_successful","legendFormat":"Reload Status","refId":"A"}]},{"title":"Alertmanager Notifications","type":"timeseries","gridPos":{"h":8,"w":12,"x":0,"y":47},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"unit":"ops","custom":{"fillOpacity":20,"lineWidth":2,"spanNulls":false}},"overrides":[]},"options":{"legend":{"displayMode":"table","calcs":["mean","max"]},"tooltip":{"mode":"multi"}},"targets":[{"expr":"rate(prometheus_notifications_sent_total[5m])","legendFormat":"{{ alertmanager }}","refId":"A"}]},{"title":"Notification Errors","type":"timeseries","gridPos":{"h":8,"w":12,"x":12,"y":47},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"unit":"ops","custom":{"fillOpacity":20,"lineWidth":2,"spanNulls":false}},"overrides":[]},"options":{"legend":{"displayMode":"table","calcs":["mean","max"]},"tooltip":{"mode":"multi"}},"targets":[{"expr":"rate(prometheus_notifications_errors_total[5m])","legendFormat":"{{ alertmanager }}","refId":"A"}]},{"title":"Go Runtime & Query Performance","type":"row","gridPos":{"h":1,"w":24,"x":0,"y":55},"collapsed":true,"panels":[{"title":"Go Memory Usage","type":"timeseries","gridPos":{"h":8,"w":12,"x":0,"y":56},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"unit":"bytes","custom":{"fillOpacity":20,"lineWidth":2,"spanNulls":false}},"overrides":[]},"options":{"legend":{"displayMode":"table","calcs":["mean","max"]},"tooltip":{"mode":"multi"}},"targets":[{"expr":"go_memstats_heap_inuse_bytes{job=\"prometheus\"}","legendFormat":"Heap In Use","refId":"A"},{"expr":"go_memstats_heap_alloc_bytes{job=\"prometheus\"}","legendFormat":"Heap Alloc","refId":"B"},{"expr":"go_memstats_stack_inuse_bytes{job=\"prometheus\"}","legendFormat":"Stack In Use","refId":"C"},{"expr":"go_memstats_sys_bytes{job=\"prometheus\"}","legendFormat":"Sys Total","refId":"D"}]},{"title":"GC Duration","type":"timeseries","gridPos":{"h":8,"w":12,"x":12,"y":56},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"unit":"s","custom":{"fillOpacity":20,"lineWidth":2,"spanNulls":false}},"overrides":[]},"options":{"legend":{"displayMode":"table","calcs":["mean","max"]},"tooltip":{"mode":"multi"}},"targets":[{"expr":"rate(go_gc_duration_seconds_sum{job=\"prometheus\"}[2m])","legendFormat":"GC Duration/s","refId":"A"}]},{"title":"Goroutines","type":"timeseries","gridPos":{"h":8,"w":12,"x":0,"y":64},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"unit":"short","custom":{"fillOpacity":20,"lineWidth":2,"spanNulls":false}},"overrides":[]},"options":{"legend":{"displayMode":"table","calcs":["mean","max"]},"tooltip":{"mode":"multi"}},"targets":[{"expr":"go_goroutines{job=\"prometheus\"}","legendFormat":"Goroutines","refId":"A"}]},{"title":"Query Engine Duration","type":"timeseries","gridPos":{"h":8,"w":12,"x":12,"y":64},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"unit":"s","custom":{"fillOpacity":20,"lineWidth":2,"spanNulls":false}},"overrides":[]},"options":{"legend":{"displayMode":"table","calcs":["mean","max"]},"tooltip":{"mode":"multi"}},"targets":[{"expr":"sum(prometheus_engine_query_duration_seconds_sum) by (slice)","legendFormat":"{{ slice }}","refId":"A"}]},{"title":"HTTP Request Rate","type":"timeseries","gridPos":{"h":8,"w":24,"x":0,"y":72},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"unit":"reqps","custom":{"fillOpacity":20,"lineWidth":2,"spanNulls":false}},"overrides":[]},"options":{"legend":{"displayMode":"table","calcs":["mean","max"]},"tooltip":{"mode":"multi"}},"targets":[{"expr":"sum(rate(prometheus_http_requests_total{job=\"prometheus\"}[5m])) by (handler, code)","legendFormat":"{{ handler }} ({{ code }})","refId":"A"}]}]}],"schemaVersion":39,"version":1}