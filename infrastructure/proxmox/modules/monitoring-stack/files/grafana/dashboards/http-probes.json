{"id":null,"uid":"http-probes","title":"HTTP Probes","description":"Blackbox exporter HTTP probes: latency, success rate, SSL certificates","tags":["blackbox","probes","http"],"timezone":"browser","editable":false,"graphTooltip":1,"refresh":"30s","time":{"from":"now-1h","to":"now"},"templating":{"list":[{"name":"app","type":"query","datasource":{"type":"prometheus","uid":"prometheus"},"query":"label_values(probe_success, app)","refresh":2,"includeAll":false,"multi":false,"sort":1},{"name":"environment","type":"query","datasource":{"type":"prometheus","uid":"prometheus"},"query":"label_values(probe_success{app=\"$app\"}, environment)","refresh":2,"includeAll":true,"multi":false,"sort":1,"current":{"text":"All","value":"$__all"}},{"name":"probe","type":"query","datasource":{"type":"prometheus","uid":"prometheus"},"query":"label_values(probe_success{app=\"$app\", environment=~\"$environment\"}, probe)","refresh":2,"includeAll":true,"multi":true,"sort":1,"current":{"text":"All","value":"$__all"}}]},"links":[{"title":"Back to Overview","url":"/d/application-overview?var-app=$app&var-environment=$environment","icon":"arrow-left","type":"link"}],"panels":[{"type":"row","title":"Overview","gridPos":{"h":1,"w":24,"x":0,"y":0},"collapsed":false},{"type":"stat","title":"Probes Up","gridPos":{"h":4,"w":4,"x":0,"y":1},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"thresholds":{"steps":[{"color":"red","value":null},{"color":"green","value":1}]}}},"options":{"colorMode":"value","graphMode":"none","reduceOptions":{"calcs":["lastNotNull"]}},"targets":[{"expr":"count(probe_success{app=\"$app\", environment=~\"$environment\", probe=~\"$probe\"} == 1)","refId":"A"}]},{"type":"stat","title":"Probes Down","gridPos":{"h":4,"w":4,"x":4,"y":1},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"thresholds":{"steps":[{"color":"green","value":null},{"color":"red","value":1}]}}},"options":{"colorMode":"value","graphMode":"none","reduceOptions":{"calcs":["lastNotNull"]}},"targets":[{"expr":"count(probe_success{app=\"$app\", environment=~\"$environment\", probe=~\"$probe\"} == 0) OR on() vector(0)","refId":"A"}]},{"type":"stat","title":"Success Rate","gridPos":{"h":4,"w":4,"x":8,"y":1},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"unit":"percent","decimals":1,"color":{"mode":"thresholds"},"thresholds":{"steps":[{"color":"red","value":null},{"color":"orange","value":90},{"color":"green","value":99}]}}},"options":{"colorMode":"value","graphMode":"area","reduceOptions":{"calcs":["mean"]}},"targets":[{"expr":"avg(avg_over_time(probe_success{app=\"$app\", environment=~\"$environment\", probe=~\"$probe\"}[1h])) * 100","refId":"A"}]},{"type":"stat","title":"Avg Latency","gridPos":{"h":4,"w":4,"x":12,"y":1},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"unit":"s","decimals":3,"color":{"mode":"thresholds"},"thresholds":{"steps":[{"color":"green","value":null},{"color":"orange","value":0.5},{"color":"red","value":1}]}}},"options":{"colorMode":"value","graphMode":"area","reduceOptions":{"calcs":["mean"]}},"targets":[{"expr":"avg(probe_duration_seconds{app=\"$app\", environment=~\"$environment\", probe=~\"$probe\"})","refId":"A"}]},{"type":"stat","title":"Max Latency","gridPos":{"h":4,"w":4,"x":16,"y":1},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"unit":"s","decimals":3,"color":{"mode":"thresholds"},"thresholds":{"steps":[{"color":"green","value":null},{"color":"orange","value":1},{"color":"red","value":2}]}}},"options":{"colorMode":"value","graphMode":"none","reduceOptions":{"calcs":["max"]}},"targets":[{"expr":"max(probe_duration_seconds{app=\"$app\", environment=~\"$environment\", probe=~\"$probe\"})","refId":"A"}]},{"type":"stat","title":"SSL Cert Expiry","gridPos":{"h":4,"w":4,"x":20,"y":1},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"unit":"d","decimals":0,"color":{"mode":"thresholds"},"thresholds":{"steps":[{"color":"red","value":null},{"color":"orange","value":14},{"color":"green","value":30}]}}},"options":{"colorMode":"value","graphMode":"none","reduceOptions":{"calcs":["min"]}},"targets":[{"expr":"min((probe_ssl_earliest_cert_expiry{app=\"$app\", environment=~\"$environment\"} - time()) / 86400)","refId":"A"}]},{"type":"row","title":"Probe Status","gridPos":{"h":1,"w":24,"x":0,"y":5},"collapsed":false},{"type":"table","title":"All Probes Status","gridPos":{"h":8,"w":24,"x":0,"y":6},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"custom":{"align":"auto"}},"overrides":[{"matcher":{"id":"byName","options":"Value"},"properties":[{"id":"displayName","value":"Status"},{"id":"custom.width","value":80},{"id":"mappings","value":[{"type":"value","options":{"0":{"text":"DOWN","color":"red"}}},{"type":"value","options":{"1":{"text":"UP","color":"green"}}}]},{"id":"custom.cellOptions","value":{"type":"color-text"}}]},{"matcher":{"id":"byName","options":"probe"},"properties":[{"id":"displayName","value":"Probe"},{"id":"custom.width","value":150}]},{"matcher":{"id":"byName","options":"target"},"properties":[{"id":"displayName","value":"Target"},{"id":"custom.width","value":300}]}]},"options":{"showHeader":true,"sortBy":[{"displayName":"Status","desc":false}]},"transformations":[{"id":"filterFieldsByName","options":{"include":{"pattern":"probe|target|Value"}}}],"targets":[{"expr":"probe_success{app=\"$app\", environment=~\"$environment\", probe=~\"$probe\"}","format":"table","instant":true,"refId":"A"}]},{"type":"row","title":"Latency","gridPos":{"h":1,"w":24,"x":0,"y":14},"collapsed":false},{"type":"timeseries","title":"Probe Duration","gridPos":{"h":8,"w":12,"x":0,"y":15},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"unit":"s","custom":{"drawStyle":"line","lineWidth":2,"fillOpacity":10,"pointSize":5,"showPoints":"never"}}},"options":{"legend":{"displayMode":"table","placement":"bottom","calcs":["mean","max"]}},"targets":[{"expr":"probe_duration_seconds{app=\"$app\", environment=~\"$environment\", probe=~\"$probe\"}","legendFormat":"{{probe}}","refId":"A"}]},{"type":"timeseries","title":"HTTP Phases","gridPos":{"h":8,"w":12,"x":12,"y":15},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"unit":"s","custom":{"drawStyle":"bars","lineWidth":1,"fillOpacity":80,"stacking":{"mode":"normal"}}}},"options":{"legend":{"displayMode":"table","placement":"bottom","calcs":["mean"]}},"targets":[{"expr":"avg(probe_http_duration_seconds{app=\"$app\", environment=~\"$environment\", phase=\"resolve\"})","legendFormat":"DNS Resolve","refId":"A"},{"expr":"avg(probe_http_duration_seconds{app=\"$app\", environment=~\"$environment\", phase=\"connect\"})","legendFormat":"Connect","refId":"B"},{"expr":"avg(probe_http_duration_seconds{app=\"$app\", environment=~\"$environment\", phase=\"tls\"})","legendFormat":"TLS","refId":"C"},{"expr":"avg(probe_http_duration_seconds{app=\"$app\", environment=~\"$environment\", phase=\"processing\"})","legendFormat":"Processing","refId":"D"},{"expr":"avg(probe_http_duration_seconds{app=\"$app\", environment=~\"$environment\", phase=\"transfer\"})","legendFormat":"Transfer","refId":"E"}]},{"type":"row","title":"Success History","gridPos":{"h":1,"w":24,"x":0,"y":23},"collapsed":false},{"type":"timeseries","title":"Probe Success Over Time","gridPos":{"h":8,"w":24,"x":0,"y":24},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"unit":"bool","min":0,"max":1,"custom":{"drawStyle":"line","lineWidth":2,"fillOpacity":30,"pointSize":5,"showPoints":"auto"},"color":{"mode":"palette-classic"}}},"options":{"legend":{"displayMode":"table","placement":"right","calcs":["mean","lastNotNull"]}},"targets":[{"expr":"probe_success{app=\"$app\", environment=~\"$environment\", probe=~\"$probe\"}","legendFormat":"{{probe}} - {{target}}","refId":"A"}]},{"type":"row","title":"SSL Certificates","gridPos":{"h":1,"w":24,"x":0,"y":32},"collapsed":false},{"type":"table","title":"SSL Certificate Expiry","gridPos":{"h":6,"w":24,"x":0,"y":33},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"custom":{"align":"auto"}},"overrides":[{"matcher":{"id":"byName","options":"Value"},"properties":[{"id":"displayName","value":"Days Left"},{"id":"unit","value":"d"},{"id":"decimals","value":0},{"id":"custom.width","value":100},{"id":"thresholds","value":{"steps":[{"color":"red","value":null},{"color":"orange","value":14},{"color":"green","value":30}]}},{"id":"custom.cellOptions","value":{"type":"color-text"}}]},{"matcher":{"id":"byName","options":"instance"},"properties":[{"id":"displayName","value":"Target"},{"id":"custom.width","value":300}]}]},"options":{"showHeader":true,"sortBy":[{"displayName":"Days Left","desc":false}]},"transformations":[{"id":"filterFieldsByName","options":{"include":{"pattern":"instance|Value"}}}],"targets":[{"expr":"(probe_ssl_earliest_cert_expiry{app=\"$app\", environment=~\"$environment\"} - time()) / 86400","format":"table","instant":true,"refId":"A"}]}],"schemaVersion":39,"version":1}