{"id":null,"uid":"docker-containers","title":"Docker Containers","description":"Container metrics from cAdvisor: CPU, memory, uptime","tags":["docker","containers","cadvisor"],"timezone":"browser","editable":false,"graphTooltip":1,"refresh":"30s","time":{"from":"now-1h","to":"now"},"templating":{"list":[{"name":"app","type":"query","datasource":{"type":"prometheus","uid":"prometheus"},"query":"label_values(container_last_seen, app)","refresh":2,"includeAll":false,"multi":false,"sort":1},{"name":"environment","type":"query","datasource":{"type":"prometheus","uid":"prometheus"},"query":"label_values(container_last_seen{app=\"$app\"}, environment)","refresh":2,"includeAll":true,"multi":false,"sort":1,"current":{"text":"All","value":"$__all"}},{"name":"container","type":"query","datasource":{"type":"prometheus","uid":"prometheus"},"query":"label_values(container_last_seen{app=\"$app\", environment=~\"$environment\", name=~\"[a-z]+-.*\"}, name)","refresh":2,"includeAll":true,"multi":true,"sort":1,"current":{"text":"All","value":"$__all"}}]},"links":[{"title":"Back to Overview","url":"/d/application-overview?var-app=$app&var-environment=$environment","icon":"arrow-left","type":"link"}],"panels":[{"type":"row","title":"Overview","gridPos":{"h":1,"w":24,"x":0,"y":0},"collapsed":false},{"type":"stat","title":"Containers Running","gridPos":{"h":4,"w":6,"x":0,"y":1},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"thresholds":{"steps":[{"color":"red","value":null},{"color":"green","value":1}]}}},"options":{"colorMode":"value","graphMode":"none","reduceOptions":{"calcs":["lastNotNull"]}},"targets":[{"expr":"count(container_last_seen{app=\"$app\", environment=~\"$environment\", name=~\"[a-z]+-.*\", name=~\"$container\"})","refId":"A"}]},{"type":"stat","title":"Total CPU Usage","gridPos":{"h":4,"w":6,"x":6,"y":1},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"unit":"percent","decimals":1,"color":{"mode":"thresholds"},"thresholds":{"steps":[{"color":"green","value":null},{"color":"orange","value":70},{"color":"red","value":90}]}}},"options":{"colorMode":"value","graphMode":"area","reduceOptions":{"calcs":["lastNotNull"]}},"targets":[{"expr":"sum(rate(container_cpu_usage_seconds_total{app=\"$app\", environment=~\"$environment\", name=~\"[a-z]+-.*\", name=~\"$container\"}[5m])) * 100","refId":"A"}]},{"type":"stat","title":"Total Memory Usage","gridPos":{"h":4,"w":6,"x":12,"y":1},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"unit":"bytes","color":{"mode":"palette-classic"}}},"options":{"colorMode":"value","graphMode":"area","reduceOptions":{"calcs":["lastNotNull"]}},"targets":[{"expr":"sum(container_memory_usage_bytes{app=\"$app\", environment=~\"$environment\", name=~\"[a-z]+-.*\", name=~\"$container\"})","refId":"A"}]},{"type":"stat","title":"Avg Memory % of Limit","gridPos":{"h":4,"w":6,"x":18,"y":1},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"unit":"percent","decimals":1,"min":0,"max":100,"color":{"mode":"thresholds"},"thresholds":{"steps":[{"color":"green","value":null},{"color":"orange","value":70},{"color":"red","value":90}]}}},"options":{"colorMode":"value","graphMode":"area","reduceOptions":{"calcs":["lastNotNull"]}},"targets":[{"expr":"avg(container_memory_usage_bytes{app=\"$app\", environment=~\"$environment\", name=~\"[a-z]+-.*\", name=~\"$container\"} / container_spec_memory_limit_bytes{app=\"$app\", environment=~\"$environment\", name=~\"[a-z]+-.*\", name=~\"$container\"} * 100)","refId":"A"}]},{"type":"row","title":"Top Consumers","gridPos":{"h":1,"w":24,"x":0,"y":5},"collapsed":false},{"type":"bargauge","title":"Top CPU Consumers","gridPos":{"h":6,"w":12,"x":0,"y":6},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"unit":"percent","decimals":2,"min":0,"color":{"mode":"thresholds"},"thresholds":{"steps":[{"color":"green","value":null},{"color":"orange","value":50},{"color":"red","value":80}]}}},"options":{"orientation":"horizontal","displayMode":"gradient","showUnfilled":true,"reduceOptions":{"calcs":["lastNotNull"]}},"targets":[{"expr":"topk(5, sum by (name) (rate(container_cpu_usage_seconds_total{app=\"$app\", environment=~\"$environment\", name=~\"[a-z]+-.*\", name=~\"$container\"}[5m])) * 100)","legendFormat":"{{name}}","refId":"A"}]},{"type":"bargauge","title":"Top Memory Consumers","gridPos":{"h":6,"w":12,"x":12,"y":6},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"unit":"bytes","min":0,"color":{"mode":"thresholds"},"thresholds":{"steps":[{"color":"green","value":null},{"color":"orange","value":134217728},{"color":"red","value":268435456}]}}},"options":{"orientation":"horizontal","displayMode":"gradient","showUnfilled":true,"reduceOptions":{"calcs":["lastNotNull"]}},"targets":[{"expr":"topk(5, sum by (name) (container_memory_usage_bytes{app=\"$app\", environment=~\"$environment\", name=~\"[a-z]+-.*\", name=~\"$container\"}))","legendFormat":"{{name}}","refId":"A"}]},{"type":"row","title":"CPU","gridPos":{"h":1,"w":24,"x":0,"y":12},"collapsed":false},{"type":"timeseries","title":"CPU Usage by Container","gridPos":{"h":8,"w":12,"x":0,"y":13},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"unit":"percent","decimals":1,"custom":{"drawStyle":"line","lineWidth":2,"fillOpacity":20,"stacking":{"mode":"normal"}}}},"options":{"legend":{"displayMode":"table","placement":"bottom","calcs":["mean","max"]}},"targets":[{"expr":"sum by (name) (rate(container_cpu_usage_seconds_total{app=\"$app\", environment=~\"$environment\", name=~\"[a-z]+-.*\", name=~\"$container\"}[5m])) * 100","legendFormat":"{{name}}","refId":"A"}]},{"type":"timeseries","title":"CPU Throttling","gridPos":{"h":8,"w":12,"x":12,"y":13},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"unit":"percent","decimals":1,"custom":{"drawStyle":"line","lineWidth":2,"fillOpacity":10}}},"options":{"legend":{"displayMode":"table","placement":"bottom","calcs":["mean","max"]}},"targets":[{"expr":"sum by (name) (rate(container_cpu_cfs_throttled_seconds_total{app=\"$app\", environment=~\"$environment\", name=~\"[a-z]+-.*\", name=~\"$container\"}[5m])) / sum by (name) (rate(container_cpu_cfs_periods_total{app=\"$app\", environment=~\"$environment\", name=~\"[a-z]+-.*\", name=~\"$container\"}[5m])) * 100","legendFormat":"{{name}}","refId":"A"}]},{"type":"row","title":"Memory","gridPos":{"h":1,"w":24,"x":0,"y":21},"collapsed":false},{"type":"timeseries","title":"Memory Usage by Container","gridPos":{"h":8,"w":12,"x":0,"y":22},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"unit":"bytes","custom":{"drawStyle":"line","lineWidth":2,"fillOpacity":20,"stacking":{"mode":"normal"}}}},"options":{"legend":{"displayMode":"table","placement":"bottom","calcs":["mean","max"]}},"targets":[{"expr":"container_memory_usage_bytes{app=\"$app\", environment=~\"$environment\", name=~\"[a-z]+-.*\", name=~\"$container\"}","legendFormat":"{{name}}","refId":"A"}]},{"type":"timeseries","title":"Memory Usage % of Limit","gridPos":{"h":8,"w":12,"x":12,"y":22},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"unit":"percent","min":0,"max":100,"custom":{"drawStyle":"line","lineWidth":2,"fillOpacity":10},"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"orange","value":70},{"color":"red","value":90}]}}},"options":{"legend":{"displayMode":"table","placement":"bottom","calcs":["mean","max"]}},"targets":[{"expr":"container_memory_usage_bytes{app=\"$app\", environment=~\"$environment\", name=~\"[a-z]+-.*\", name=~\"$container\"} / container_spec_memory_limit_bytes{app=\"$app\", environment=~\"$environment\", name=~\"[a-z]+-.*\", name=~\"$container\"} * 100","legendFormat":"{{name}}","refId":"A"}]},{"type":"row","title":"Container Status","gridPos":{"h":1,"w":24,"x":0,"y":30},"collapsed":false},{"type":"table","title":"All Containers","gridPos":{"h":10,"w":24,"x":0,"y":31},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"custom":{"align":"auto"}},"overrides":[{"matcher":{"id":"byName","options":"name"},"properties":[{"id":"displayName","value":"Container"},{"id":"custom.width","value":200}]},{"matcher":{"id":"byName","options":"Value #A"},"properties":[{"id":"displayName","value":"CPU %"},{"id":"unit","value":"percent"},{"id":"decimals","value":2},{"id":"custom.width","value":100},{"id":"custom.cellOptions","value":{"type":"color-background","mode":"gradient"}},{"id":"thresholds","value":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"orange","value":50},{"color":"red","value":80}]}}]},{"matcher":{"id":"byName","options":"Value #B"},"properties":[{"id":"displayName","value":"Memory"},{"id":"unit","value":"bytes"},{"id":"custom.width","value":100}]},{"matcher":{"id":"byName","options":"Value #C"},"properties":[{"id":"displayName","value":"Mem %"},{"id":"unit","value":"percent"},{"id":"decimals","value":1},{"id":"custom.width","value":100},{"id":"custom.cellOptions","value":{"type":"color-background","mode":"gradient"}},{"id":"thresholds","value":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"orange","value":50},{"color":"red","value":80}]}}]},{"matcher":{"id":"byName","options":"Value #D"},"properties":[{"id":"displayName","value":"Uptime"},{"id":"unit","value":"dtdurations"},{"id":"custom.width","value":120}]}]},"options":{"showHeader":true,"sortBy":[{"displayName":"CPU %","desc":true}]},"transformations":[{"id":"joinByField","options":{"byField":"name","mode":"outer"}},{"id":"filterFieldsByName","options":{"include":{"pattern":"^(name|Value #[A-D])$"}}},{"id":"organize","options":{"indexByName":{"name":0,"Value #A":1,"Value #B":2,"Value #C":3,"Value #D":4}}}],"targets":[{"expr":"sum by (name) (rate(container_cpu_usage_seconds_total{app=\"$app\", environment=~\"$environment\", name=~\"[a-z]+-.*\", name=~\"$container\"}[5m])) * 100","format":"table","instant":true,"refId":"A"},{"expr":"sum by (name) (container_memory_usage_bytes{app=\"$app\", environment=~\"$environment\", name=~\"[a-z]+-.*\", name=~\"$container\"})","format":"table","instant":true,"refId":"B"},{"expr":"container_memory_usage_bytes{app=\"$app\", environment=~\"$environment\", name=~\"[a-z]+-.*\", name=~\"$container\"} / container_spec_memory_limit_bytes{app=\"$app\", environment=~\"$environment\", name=~\"[a-z]+-.*\", name=~\"$container\"} * 100","format":"table","instant":true,"refId":"C"},{"expr":"time() - container_start_time_seconds{app=\"$app\", environment=~\"$environment\", name=~\"[a-z]+-.*\", name=~\"$container\"}","format":"table","instant":true,"refId":"D"}]}],"schemaVersion":39,"version":1}
