{"id":null,"uid":"step-ca","title":"Step-ca - PKI Monitoring","description":"Step-ca PKI Certificate Authority monitoring: certificates, ACME, health","tags":["tooling","pki","step-ca","certificates"],"timezone":"browser","editable":false,"graphTooltip":1,"refresh":"30s","time":{"from":"now-1h","to":"now"},"templating":{"list":[{"name":"instance","type":"query","datasource":{"type":"prometheus","uid":"prometheus"},"query":"label_values(step_ca_health_status, instance)","current":{"text":"All","value":"$__all"},"includeAll":true,"multi":true}]},"panels":[{"title":"CA Health","type":"stat","gridPos":{"h":4,"w":4,"x":0,"y":0},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"mappings":[{"type":"value","options":{"1":{"text":"Healthy","color":"green"},"0":{"text":"Unhealthy","color":"red"}}}],"thresholds":{"steps":[{"color":"red","value":null},{"color":"green","value":1}]}},"overrides":[]},"options":{"colorMode":"background","graphMode":"none","textMode":"auto"},"targets":[{"expr":"step_ca_health_status{instance=~\"$instance\"}","legendFormat":"","refId":"A"}]},{"title":"Certificates Issued (24h)","type":"stat","gridPos":{"h":4,"w":4,"x":4,"y":0},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"thresholds":{"steps":[{"color":"blue","value":null}]}},"overrides":[]},"options":{"colorMode":"value","graphMode":"area","textMode":"auto"},"targets":[{"expr":"increase(step_ca_certificate_sign_count{instance=~\"$instance\"}[24h])","legendFormat":"","refId":"A"}]},{"title":"ACME Requests (24h)","type":"stat","gridPos":{"h":4,"w":4,"x":8,"y":0},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"thresholds":{"steps":[{"color":"purple","value":null}]}},"overrides":[]},"options":{"colorMode":"value","graphMode":"area","textMode":"auto"},"targets":[{"expr":"increase(step_ca_acme_request_count{instance=~\"$instance\"}[24h])","legendFormat":"","refId":"A"}]},{"title":"Active Certificates","type":"stat","gridPos":{"h":4,"w":4,"x":12,"y":0},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"thresholds":{"steps":[{"color":"green","value":null}]}},"overrides":[]},"options":{"colorMode":"value","graphMode":"none","textMode":"auto"},"targets":[{"expr":"step_ca_certificate_active_count{instance=~\"$instance\"}","legendFormat":"","refId":"A"}]},{"title":"CA Uptime","type":"stat","gridPos":{"h":4,"w":4,"x":16,"y":0},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"unit":"s","thresholds":{"steps":[{"color":"green","value":null}]}},"overrides":[]},"options":{"colorMode":"value","graphMode":"none","textMode":"auto"},"targets":[{"expr":"time() - process_start_time_seconds{job=\"step-ca\",instance=~\"$instance\"}","legendFormat":"","refId":"A"}]},{"title":"Root CA Expiry","type":"stat","gridPos":{"h":4,"w":4,"x":20,"y":0},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"unit":"d","thresholds":{"steps":[{"color":"red","value":null},{"color":"yellow","value":30},{"color":"green","value":90}]}},"overrides":[]},"options":{"colorMode":"background","graphMode":"none","textMode":"auto"},"targets":[{"expr":"(step_ca_root_certificate_expiry_timestamp_seconds{instance=~\"$instance\"} - time()) / 86400","legendFormat":"","refId":"A"}]},{"title":"Certificate Operations","type":"row","gridPos":{"h":1,"w":24,"x":0,"y":4},"collapsed":false,"panels":[]},{"title":"Certificates Signed Rate","type":"timeseries","gridPos":{"h":8,"w":12,"x":0,"y":5},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"unit":"ops","custom":{"fillOpacity":20,"lineWidth":2,"spanNulls":false}},"overrides":[]},"options":{"legend":{"displayMode":"table","calcs":["mean","max"]},"tooltip":{"mode":"multi"}},"targets":[{"expr":"rate(step_ca_certificate_sign_count{instance=~\"$instance\"}[5m])","legendFormat":"{{ provisioner }}","refId":"A"}]},{"title":"Certificate Renewals Rate","type":"timeseries","gridPos":{"h":8,"w":12,"x":12,"y":5},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"unit":"ops","custom":{"fillOpacity":20,"lineWidth":2,"spanNulls":false}},"overrides":[]},"options":{"legend":{"displayMode":"table","calcs":["mean","max"]},"tooltip":{"mode":"multi"}},"targets":[{"expr":"rate(step_ca_certificate_renew_count{instance=~\"$instance\"}[5m])","legendFormat":"{{ provisioner }}","refId":"A"}]},{"title":"Certificate Sign Duration","type":"timeseries","gridPos":{"h":8,"w":12,"x":0,"y":13},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"unit":"s","custom":{"fillOpacity":20,"lineWidth":2,"spanNulls":false}},"overrides":[]},"options":{"legend":{"displayMode":"table","calcs":["mean","p95","max"]},"tooltip":{"mode":"multi"}},"targets":[{"expr":"histogram_quantile(0.95, sum(rate(step_ca_certificate_sign_duration_seconds_bucket{instance=~\"$instance\"}[5m])) by (le))","legendFormat":"p95","refId":"A"},{"expr":"histogram_quantile(0.50, sum(rate(step_ca_certificate_sign_duration_seconds_bucket{instance=~\"$instance\"}[5m])) by (le))","legendFormat":"p50","refId":"B"}]},{"title":"Certificate Errors","type":"timeseries","gridPos":{"h":8,"w":12,"x":12,"y":13},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"unit":"ops","custom":{"fillOpacity":20,"lineWidth":2,"spanNulls":false}},"overrides":[]},"options":{"legend":{"displayMode":"table","calcs":["mean","max"]},"tooltip":{"mode":"multi"}},"targets":[{"expr":"rate(step_ca_certificate_sign_errors_total{instance=~\"$instance\"}[5m])","legendFormat":"Sign Errors","refId":"A"},{"expr":"rate(step_ca_certificate_revoke_errors_total{instance=~\"$instance\"}[5m])","legendFormat":"Revoke Errors","refId":"B"}]},{"title":"ACME Protocol","type":"row","gridPos":{"h":1,"w":24,"x":0,"y":21},"collapsed":false,"panels":[]},{"title":"ACME Requests by Type","type":"timeseries","gridPos":{"h":8,"w":12,"x":0,"y":22},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"unit":"ops","custom":{"fillOpacity":20,"lineWidth":2,"spanNulls":false}},"overrides":[]},"options":{"legend":{"displayMode":"table","calcs":["mean","max"]},"tooltip":{"mode":"multi"}},"targets":[{"expr":"rate(step_ca_acme_request_count{instance=~\"$instance\"}[5m])","legendFormat":"{{ type }}","refId":"A"}]},{"title":"ACME Challenge Success Rate","type":"timeseries","gridPos":{"h":8,"w":12,"x":12,"y":22},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"unit":"percentunit","custom":{"fillOpacity":20,"lineWidth":2,"spanNulls":false},"min":0,"max":1},"overrides":[]},"options":{"legend":{"displayMode":"table","calcs":["mean","min"]},"tooltip":{"mode":"multi"}},"targets":[{"expr":"sum(rate(step_ca_acme_challenge_success_total{instance=~\"$instance\"}[5m])) / (sum(rate(step_ca_acme_challenge_success_total{instance=~\"$instance\"}[5m])) + sum(rate(step_ca_acme_challenge_failure_total{instance=~\"$instance\"}[5m])))","legendFormat":"Success Rate","refId":"A"}]},{"title":"HTTP & Resources","type":"row","gridPos":{"h":1,"w":24,"x":0,"y":30},"collapsed":true,"panels":[{"title":"HTTP Requests by Status","type":"timeseries","gridPos":{"h":8,"w":12,"x":0,"y":31},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"unit":"ops","custom":{"fillOpacity":20,"lineWidth":2,"spanNulls":false}},"overrides":[]},"options":{"legend":{"displayMode":"table","calcs":["mean","max"]},"tooltip":{"mode":"multi"}},"targets":[{"expr":"sum(rate(step_ca_http_requests_total{instance=~\"$instance\"}[5m])) by (code)","legendFormat":"{{ code }}","refId":"A"}]},{"title":"HTTP Request Duration","type":"timeseries","gridPos":{"h":8,"w":12,"x":12,"y":31},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"unit":"s","custom":{"fillOpacity":20,"lineWidth":2,"spanNulls":false}},"overrides":[]},"options":{"legend":{"displayMode":"table","calcs":["mean","p95"]},"tooltip":{"mode":"multi"}},"targets":[{"expr":"histogram_quantile(0.95, sum(rate(step_ca_http_request_duration_seconds_bucket{instance=~\"$instance\"}[5m])) by (le, handler))","legendFormat":"p95 {{ handler }}","refId":"A"}]},{"title":"Memory Usage","type":"timeseries","gridPos":{"h":8,"w":12,"x":0,"y":39},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"unit":"bytes","custom":{"fillOpacity":20,"lineWidth":2,"spanNulls":false}},"overrides":[]},"options":{"legend":{"displayMode":"table","calcs":["mean","max"]},"tooltip":{"mode":"multi"}},"targets":[{"expr":"process_resident_memory_bytes{job=\"step-ca\",instance=~\"$instance\"}","legendFormat":"RSS","refId":"A"},{"expr":"go_memstats_heap_inuse_bytes{job=\"step-ca\",instance=~\"$instance\"}","legendFormat":"Heap In Use","refId":"B"}]},{"title":"CPU Usage","type":"timeseries","gridPos":{"h":8,"w":12,"x":12,"y":39},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"unit":"percentunit","custom":{"fillOpacity":20,"lineWidth":2,"spanNulls":false}},"overrides":[]},"options":{"legend":{"displayMode":"table","calcs":["mean","max"]},"tooltip":{"mode":"multi"}},"targets":[{"expr":"rate(process_cpu_seconds_total{job=\"step-ca\",instance=~\"$instance\"}[5m])","legendFormat":"CPU","refId":"A"}]}]}],"schemaVersion":39,"version":1}
