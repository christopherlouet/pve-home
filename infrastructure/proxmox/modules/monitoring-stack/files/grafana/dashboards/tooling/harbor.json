{"id":null,"uid":"harbor","title":"Harbor - Registry Monitoring","description":"Harbor container registry monitoring: storage, images, vulnerabilities, replication","tags":["tooling","registry","harbor","docker"],"timezone":"browser","editable":false,"graphTooltip":1,"refresh":"30s","time":{"from":"now-1h","to":"now"},"templating":{"list":[{"name":"instance","type":"query","datasource":{"type":"prometheus","uid":"prometheus"},"query":"label_values(harbor_health, instance)","current":{"text":"All","value":"$__all"},"includeAll":true,"multi":true}]},"panels":[{"title":"Harbor Health","type":"stat","gridPos":{"h":4,"w":4,"x":0,"y":0},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"mappings":[{"type":"value","options":{"1":{"text":"Healthy","color":"green"},"0":{"text":"Unhealthy","color":"red"}}}],"thresholds":{"steps":[{"color":"red","value":null},{"color":"green","value":1}]}},"overrides":[]},"options":{"colorMode":"background","graphMode":"none","textMode":"auto"},"targets":[{"expr":"harbor_health{instance=~\"$instance\"}","legendFormat":"","refId":"A"}]},{"title":"Total Projects","type":"stat","gridPos":{"h":4,"w":4,"x":4,"y":0},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"thresholds":{"steps":[{"color":"blue","value":null}]}},"overrides":[]},"options":{"colorMode":"value","graphMode":"none","textMode":"auto"},"targets":[{"expr":"harbor_project_total{instance=~\"$instance\"}","legendFormat":"","refId":"A"}]},{"title":"Total Repositories","type":"stat","gridPos":{"h":4,"w":4,"x":8,"y":0},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"thresholds":{"steps":[{"color":"purple","value":null}]}},"overrides":[]},"options":{"colorMode":"value","graphMode":"none","textMode":"auto"},"targets":[{"expr":"harbor_repo_total{instance=~\"$instance\"}","legendFormat":"","refId":"A"}]},{"title":"Storage Used","type":"stat","gridPos":{"h":4,"w":4,"x":12,"y":0},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"unit":"bytes","thresholds":{"steps":[{"color":"green","value":null},{"color":"yellow","value":80},{"color":"red","value":90}]}},"overrides":[]},"options":{"colorMode":"value","graphMode":"area","textMode":"auto"},"targets":[{"expr":"harbor_storage_usage_bytes{instance=~\"$instance\"}","legendFormat":"","refId":"A"}]},{"title":"Storage Free %","type":"gauge","gridPos":{"h":4,"w":4,"x":16,"y":0},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"unit":"percentunit","min":0,"max":1,"thresholds":{"steps":[{"color":"red","value":null},{"color":"yellow","value":0.1},{"color":"green","value":0.2}]}},"overrides":[]},"options":{"showThresholdMarkers":true},"targets":[{"expr":"1 - (harbor_storage_usage_bytes{instance=~\"$instance\"} / harbor_storage_total_bytes{instance=~\"$instance\"})","legendFormat":"","refId":"A"}]},{"title":"Critical Vulns","type":"stat","gridPos":{"h":4,"w":4,"x":20,"y":0},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"thresholds":{"steps":[{"color":"green","value":null},{"color":"yellow","value":1},{"color":"red","value":5}]}},"overrides":[]},"options":{"colorMode":"background","graphMode":"none","textMode":"auto"},"targets":[{"expr":"sum(harbor_artifact_vulnerability_total{severity=\"Critical\",instance=~\"$instance\"}) or vector(0)","legendFormat":"","refId":"A"}]},{"title":"Image Operations","type":"row","gridPos":{"h":1,"w":24,"x":0,"y":4},"collapsed":false,"panels":[]},{"title":"Push Rate","type":"timeseries","gridPos":{"h":8,"w":8,"x":0,"y":5},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"unit":"ops","custom":{"fillOpacity":20,"lineWidth":2,"spanNulls":false}},"overrides":[]},"options":{"legend":{"displayMode":"table","calcs":["mean","max"]},"tooltip":{"mode":"multi"}},"targets":[{"expr":"rate(harbor_artifact_pushed_total{instance=~\"$instance\"}[5m])","legendFormat":"Push/s","refId":"A"}]},{"title":"Pull Rate","type":"timeseries","gridPos":{"h":8,"w":8,"x":8,"y":5},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"unit":"ops","custom":{"fillOpacity":20,"lineWidth":2,"spanNulls":false}},"overrides":[]},"options":{"legend":{"displayMode":"table","calcs":["mean","max"]},"tooltip":{"mode":"multi"}},"targets":[{"expr":"rate(harbor_artifact_pulled_total{instance=~\"$instance\"}[5m])","legendFormat":"Pull/s","refId":"A"}]},{"title":"Bandwidth","type":"timeseries","gridPos":{"h":8,"w":8,"x":16,"y":5},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"unit":"Bps","custom":{"fillOpacity":20,"lineWidth":2,"spanNulls":false}},"overrides":[]},"options":{"legend":{"displayMode":"table","calcs":["mean","max"]},"tooltip":{"mode":"multi"}},"targets":[{"expr":"rate(harbor_registry_storage_transfer_in_bytes_total{instance=~\"$instance\"}[5m])","legendFormat":"In","refId":"A"},{"expr":"rate(harbor_registry_storage_transfer_out_bytes_total{instance=~\"$instance\"}[5m])","legendFormat":"Out","refId":"B"}]},{"title":"Vulnerability Scanning","type":"row","gridPos":{"h":1,"w":24,"x":0,"y":13},"collapsed":false,"panels":[]},{"title":"Vulnerabilities by Severity","type":"piechart","gridPos":{"h":8,"w":8,"x":0,"y":14},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"custom":{"hideFrom":{"legend":false,"tooltip":false,"viz":false}}},"overrides":[{"matcher":{"id":"byName","options":"Critical"},"properties":[{"id":"color","value":{"mode":"fixed","fixedColor":"red"}}]},{"matcher":{"id":"byName","options":"High"},"properties":[{"id":"color","value":{"mode":"fixed","fixedColor":"orange"}}]},{"matcher":{"id":"byName","options":"Medium"},"properties":[{"id":"color","value":{"mode":"fixed","fixedColor":"yellow"}}]},{"matcher":{"id":"byName","options":"Low"},"properties":[{"id":"color","value":{"mode":"fixed","fixedColor":"blue"}}]}]},"options":{"legend":{"displayMode":"table","placement":"right","values":["value"]},"pieType":"pie","tooltip":{"mode":"single"}},"targets":[{"expr":"sum(harbor_artifact_vulnerability_total{instance=~\"$instance\"}) by (severity)","legendFormat":"{{ severity }}","refId":"A"}]},{"title":"Scan Queue","type":"timeseries","gridPos":{"h":8,"w":8,"x":8,"y":14},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"unit":"short","custom":{"fillOpacity":20,"lineWidth":2,"spanNulls":false}},"overrides":[]},"options":{"legend":{"displayMode":"table","calcs":["mean","max"]},"tooltip":{"mode":"multi"}},"targets":[{"expr":"harbor_task_queue_size{type=\"scan\",instance=~\"$instance\"}","legendFormat":"Queue Size","refId":"A"},{"expr":"harbor_task_concurrency{type=\"scan\",instance=~\"$instance\"}","legendFormat":"Running","refId":"B"}]},{"title":"Scan Duration","type":"timeseries","gridPos":{"h":8,"w":8,"x":16,"y":14},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"unit":"s","custom":{"fillOpacity":20,"lineWidth":2,"spanNulls":false}},"overrides":[]},"options":{"legend":{"displayMode":"table","calcs":["mean","p95"]},"tooltip":{"mode":"multi"}},"targets":[{"expr":"histogram_quantile(0.95, sum(rate(harbor_task_execution_time_seconds_bucket{type=\"scan\",instance=~\"$instance\"}[5m])) by (le))","legendFormat":"p95","refId":"A"},{"expr":"histogram_quantile(0.50, sum(rate(harbor_task_execution_time_seconds_bucket{type=\"scan\",instance=~\"$instance\"}[5m])) by (le))","legendFormat":"p50","refId":"B"}]},{"title":"Storage & Garbage Collection","type":"row","gridPos":{"h":1,"w":24,"x":0,"y":22},"collapsed":false,"panels":[]},{"title":"Storage Growth","type":"timeseries","gridPos":{"h":8,"w":12,"x":0,"y":23},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"unit":"bytes","custom":{"fillOpacity":20,"lineWidth":2,"spanNulls":false}},"overrides":[]},"options":{"legend":{"displayMode":"table","calcs":["mean","max"]},"tooltip":{"mode":"multi"}},"targets":[{"expr":"harbor_storage_usage_bytes{instance=~\"$instance\"}","legendFormat":"Used","refId":"A"},{"expr":"harbor_storage_total_bytes{instance=~\"$instance\"}","legendFormat":"Total","refId":"B"}]},{"title":"GC Reclaimed Space","type":"timeseries","gridPos":{"h":8,"w":12,"x":12,"y":23},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"unit":"bytes","custom":{"fillOpacity":20,"lineWidth":2,"spanNulls":false}},"overrides":[]},"options":{"legend":{"displayMode":"table","calcs":["mean","max"]},"tooltip":{"mode":"multi"}},"targets":[{"expr":"increase(harbor_gc_deleted_blobs_size_bytes{instance=~\"$instance\"}[24h])","legendFormat":"Reclaimed (24h)","refId":"A"}]},{"title":"Components Health","type":"row","gridPos":{"h":1,"w":24,"x":0,"y":31},"collapsed":true,"panels":[{"title":"Component Status","type":"table","gridPos":{"h":8,"w":24,"x":0,"y":32},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"mappings":[{"type":"value","options":{"1":{"text":"Up","color":"green"},"0":{"text":"Down","color":"red"}}}],"custom":{"align":"center"}},"overrides":[]},"options":{"showHeader":true,"cellHeight":"sm"},"targets":[{"expr":"harbor_component_health{instance=~\"$instance\"}","legendFormat":"","format":"table","refId":"A"}],"transformations":[{"id":"organize","options":{"excludeByName":{"Time":true,"__name__":true,"job":true},"renameByName":{"component":"Component","instance":"Instance","value":"Status"}}}]},{"title":"Database Connections","type":"timeseries","gridPos":{"h":8,"w":12,"x":0,"y":40},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"unit":"short","custom":{"fillOpacity":20,"lineWidth":2,"spanNulls":false}},"overrides":[]},"options":{"legend":{"displayMode":"table","calcs":["mean","max"]},"tooltip":{"mode":"multi"}},"targets":[{"expr":"harbor_core_db_pool_in_use{instance=~\"$instance\"}","legendFormat":"In Use","refId":"A"},{"expr":"harbor_core_db_pool_idle{instance=~\"$instance\"}","legendFormat":"Idle","refId":"B"}]},{"title":"Redis Operations","type":"timeseries","gridPos":{"h":8,"w":12,"x":12,"y":40},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"unit":"ops","custom":{"fillOpacity":20,"lineWidth":2,"spanNulls":false}},"overrides":[]},"options":{"legend":{"displayMode":"table","calcs":["mean","max"]},"tooltip":{"mode":"multi"}},"targets":[{"expr":"rate(harbor_redis_commands_total{instance=~\"$instance\"}[5m])","legendFormat":"Commands/s","refId":"A"}]}]}],"schemaVersion":39,"version":1}
