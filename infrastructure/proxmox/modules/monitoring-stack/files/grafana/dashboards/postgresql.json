{"id":null,"uid":"postgresql","title":"PostgreSQL","description":"PostgreSQL database metrics from postgres_exporter","tags":["postgresql","database"],"timezone":"browser","editable":false,"graphTooltip":1,"refresh":"30s","time":{"from":"now-1h","to":"now"},"templating":{"list":[{"name":"app","type":"query","datasource":{"type":"prometheus","uid":"prometheus"},"query":"label_values(pg_up, app)","refresh":2,"includeAll":false,"multi":false,"sort":1},{"name":"environment","type":"query","datasource":{"type":"prometheus","uid":"prometheus"},"query":"label_values(pg_up{app=\"$app\"}, environment)","refresh":2,"includeAll":true,"multi":false,"sort":1,"current":{"text":"All","value":"$__all"}},{"name":"database","type":"query","datasource":{"type":"prometheus","uid":"prometheus"},"query":"label_values(pg_stat_database_numbackends{app=\"$app\", environment=~\"$environment\"}, datname)","refresh":2,"includeAll":true,"multi":true,"sort":1,"current":{"text":"All","value":"$__all"}}]},"links":[{"title":"Back to Overview","url":"/d/application-overview?var-app=$app&var-environment=$environment","icon":"arrow-left","type":"link"}],"panels":[{"type":"row","title":"Overview","gridPos":{"h":1,"w":24,"x":0,"y":0},"collapsed":false},{"type":"stat","title":"PostgreSQL Up","gridPos":{"h":4,"w":4,"x":0,"y":1},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"thresholds":{"steps":[{"color":"red","value":null},{"color":"green","value":1}]},"mappings":[{"type":"value","options":{"0":{"text":"DOWN"},"1":{"text":"UP"}}}]}},"options":{"colorMode":"background","graphMode":"none","reduceOptions":{"calcs":["lastNotNull"]}},"targets":[{"expr":"pg_up{app=\"$app\", environment=~\"$environment\"}","refId":"A"}]},{"type":"stat","title":"Active Connections","gridPos":{"h":4,"w":4,"x":4,"y":1},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"thresholds":{"steps":[{"color":"green","value":null},{"color":"orange","value":50},{"color":"red","value":90}]}}},"options":{"colorMode":"value","graphMode":"area","reduceOptions":{"calcs":["lastNotNull"]}},"targets":[{"expr":"sum(pg_stat_activity_count{app=\"$app\", environment=~\"$environment\", state=\"active\"})","refId":"A"}]},{"type":"stat","title":"Total Connections","gridPos":{"h":4,"w":4,"x":8,"y":1},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"thresholds":{"steps":[{"color":"green","value":null},{"color":"orange","value":80},{"color":"red","value":95}]}}},"options":{"colorMode":"value","graphMode":"area","reduceOptions":{"calcs":["lastNotNull"]}},"targets":[{"expr":"sum(pg_stat_activity_count{app=\"$app\", environment=~\"$environment\"})","refId":"A"}]},{"type":"gauge","title":"Cache Hit Ratio","gridPos":{"h":4,"w":4,"x":12,"y":1},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"unit":"percent","decimals":1,"min":0,"max":100,"color":{"mode":"thresholds"},"thresholds":{"steps":[{"color":"red","value":null},{"color":"orange","value":90},{"color":"green","value":95}]}}},"options":{"reduceOptions":{"calcs":["lastNotNull"]},"showThresholdMarkers":true},"targets":[{"expr":"sum(pg_stat_database_blks_hit{app=\"$app\", environment=~\"$environment\", datname=~\"$database\"}) / (sum(pg_stat_database_blks_hit{app=\"$app\", environment=~\"$environment\", datname=~\"$database\"}) + sum(pg_stat_database_blks_read{app=\"$app\", environment=~\"$environment\", datname=~\"$database\"})) * 100","refId":"A"}]},{"type":"stat","title":"Transactions/sec","gridPos":{"h":4,"w":4,"x":16,"y":1},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"unit":"ops","decimals":1,"color":{"mode":"palette-classic"}}},"options":{"colorMode":"value","graphMode":"area","reduceOptions":{"calcs":["lastNotNull"]}},"targets":[{"expr":"sum(rate(pg_stat_database_xact_commit{app=\"$app\", environment=~\"$environment\", datname=~\"$database\"}[1m]))","refId":"A"}]},{"type":"stat","title":"Database Size","gridPos":{"h":4,"w":4,"x":20,"y":1},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"unit":"bytes","color":{"mode":"palette-classic"}}},"options":{"colorMode":"value","graphMode":"none","reduceOptions":{"calcs":["lastNotNull"]}},"targets":[{"expr":"sum(pg_database_size_bytes{app=\"$app\", environment=~\"$environment\", datname=~\"$database\"})","refId":"A"}]},{"type":"row","title":"Connections","gridPos":{"h":1,"w":24,"x":0,"y":5},"collapsed":false},{"type":"timeseries","title":"Connections by State","gridPos":{"h":8,"w":12,"x":0,"y":6},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"custom":{"drawStyle":"line","lineWidth":2,"fillOpacity":30,"stacking":{"mode":"normal"}}}},"options":{"legend":{"displayMode":"table","placement":"bottom","calcs":["mean","max"]}},"targets":[{"expr":"pg_stat_activity_count{app=\"$app\", environment=~\"$environment\", state=\"active\"}","legendFormat":"active","refId":"A"},{"expr":"pg_stat_activity_count{app=\"$app\", environment=~\"$environment\", state=\"idle\"}","legendFormat":"idle","refId":"B"},{"expr":"pg_stat_activity_count{app=\"$app\", environment=~\"$environment\", state=\"idle in transaction\"}","legendFormat":"idle in transaction","refId":"C"},{"expr":"pg_stat_activity_count{app=\"$app\", environment=~\"$environment\", state=\"idle in transaction (aborted)\"}","legendFormat":"idle in transaction (aborted)","refId":"D"}]},{"type":"timeseries","title":"Connections by Database","gridPos":{"h":8,"w":12,"x":12,"y":6},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"custom":{"drawStyle":"line","lineWidth":2,"fillOpacity":20}}},"options":{"legend":{"displayMode":"table","placement":"bottom","calcs":["mean","max"]}},"targets":[{"expr":"pg_stat_database_numbackends{app=\"$app\", environment=~\"$environment\", datname=~\"$database\"}","legendFormat":"{{datname}}","refId":"A"}]},{"type":"row","title":"Transactions","gridPos":{"h":1,"w":24,"x":0,"y":14},"collapsed":false},{"type":"timeseries","title":"Transactions per Second","gridPos":{"h":8,"w":12,"x":0,"y":15},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"unit":"ops","custom":{"drawStyle":"line","lineWidth":2,"fillOpacity":20}}},"options":{"legend":{"displayMode":"table","placement":"bottom","calcs":["mean","max"]}},"targets":[{"expr":"sum by (datname) (rate(pg_stat_database_xact_commit{app=\"$app\", environment=~\"$environment\", datname=~\"$database\"}[1m]))","legendFormat":"{{datname}} commits","refId":"A"},{"expr":"sum by (datname) (rate(pg_stat_database_xact_rollback{app=\"$app\", environment=~\"$environment\", datname=~\"$database\"}[1m]))","legendFormat":"{{datname}} rollbacks","refId":"B"}]},{"type":"timeseries","title":"Rows Operations per Second","gridPos":{"h":8,"w":12,"x":12,"y":15},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"unit":"ops","custom":{"drawStyle":"line","lineWidth":2,"fillOpacity":10}}},"options":{"legend":{"displayMode":"table","placement":"bottom","calcs":["mean","max"]}},"targets":[{"expr":"sum(rate(pg_stat_database_tup_fetched{app=\"$app\", environment=~\"$environment\", datname=~\"$database\"}[1m]))","legendFormat":"fetched","refId":"A"},{"expr":"sum(rate(pg_stat_database_tup_inserted{app=\"$app\", environment=~\"$environment\", datname=~\"$database\"}[1m]))","legendFormat":"inserted","refId":"B"},{"expr":"sum(rate(pg_stat_database_tup_updated{app=\"$app\", environment=~\"$environment\", datname=~\"$database\"}[1m]))","legendFormat":"updated","refId":"C"},{"expr":"sum(rate(pg_stat_database_tup_deleted{app=\"$app\", environment=~\"$environment\", datname=~\"$database\"}[1m]))","legendFormat":"deleted","refId":"D"}]},{"type":"row","title":"Performance","gridPos":{"h":1,"w":24,"x":0,"y":23},"collapsed":false},{"type":"timeseries","title":"Cache Hit Ratio","gridPos":{"h":8,"w":12,"x":0,"y":24},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"unit":"percent","min":0,"max":100,"custom":{"drawStyle":"line","lineWidth":2,"fillOpacity":10},"thresholds":{"mode":"absolute","steps":[{"color":"red","value":null},{"color":"orange","value":90},{"color":"green","value":95}]}}},"options":{"legend":{"displayMode":"table","placement":"bottom","calcs":["mean","min"]}},"targets":[{"expr":"pg_stat_database_blks_hit{app=\"$app\", environment=~\"$environment\", datname=~\"$database\"} / (pg_stat_database_blks_hit{app=\"$app\", environment=~\"$environment\", datname=~\"$database\"} + pg_stat_database_blks_read{app=\"$app\", environment=~\"$environment\", datname=~\"$database\"}) * 100","legendFormat":"{{datname}}","refId":"A"}]},{"type":"timeseries","title":"Locks","gridPos":{"h":8,"w":12,"x":12,"y":24},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"custom":{"drawStyle":"line","lineWidth":2,"fillOpacity":20}}},"options":{"legend":{"displayMode":"table","placement":"bottom","calcs":["mean","max"]}},"targets":[{"expr":"pg_locks_count{app=\"$app\", environment=~\"$environment\"}","legendFormat":"{{mode}}","refId":"A"}]},{"type":"row","title":"Database Sizes","gridPos":{"h":1,"w":24,"x":0,"y":32},"collapsed":false},{"type":"bargauge","title":"Database Sizes","gridPos":{"h":8,"w":24,"x":0,"y":33},"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"unit":"bytes","color":{"mode":"palette-classic"},"thresholds":{"steps":[{"color":"green","value":null}]}}},"options":{"displayMode":"gradient","orientation":"horizontal","reduceOptions":{"calcs":["lastNotNull"]}},"targets":[{"expr":"pg_database_size_bytes{app=\"$app\", environment=~\"$environment\", datname=~\"$database\", datname!~\"template.*\"}","legendFormat":"{{datname}}","refId":"A"}]}],"schemaVersion":39,"version":1}